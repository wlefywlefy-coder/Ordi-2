
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ORDI Smart Dashboard — Accurate v3</title>
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#94a3b8; --accent:#22d3ee; --good:#10b981; --bad:#f43f5e;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:var(--bg); color:var(--text);}
  header{display:flex; justify-content:space-between; align-items:center; padding:16px 20px; position:sticky; top:0; background:linear-gradient(180deg, rgba(15,23,42,.95) 0%, rgba(15,23,42,.75) 100%); backdrop-filter: blur(6px);}
  h1{font-size:20px; margin:0; letter-spacing:.3px}
  .btn{background:#1f2937; color:var(--text); border:1px solid #334155; padding:8px 12px; border-radius:10px; cursor:pointer}
  .grid{display:grid; gap:14px; padding:16px; grid-template-columns: repeat(1, minmax(0,1fr)); max-width:900px; margin:0 auto;}
  .card{background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:14px 16px;}
  .title{font-size:14px; color:var(--muted); margin-bottom:6px}
  .value{font-size:26px; font-weight:700; letter-spacing:.3px}
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .pill{font-size:12px; color:var(--muted); border:1px dashed #334155; padding:2px 8px; border-radius:999px}
  .ok{color:var(--good)} .warn{color:var(--bad)}
  footer{color:var(--muted); font-size:12px; text-align:center; padding:10px 0 30px}
  a{color:var(--accent); text-decoration:none}
  .small{font-size:12px; color:var(--muted); margin-top:6px}
</style>
</head>
<body>
<header>
  <h1>ORDI Smart Dashboard <span style="opacity:.6">v3</span></h1>
  <div class="row">
    <button id="refresh" class="btn">Refresh</button>
    <span id="updated" class="pill">Updated: --</span>
  </div>
</header>

<section class="grid">
  <div class="card"><div class="title">ORDI Price (Binance Spot)</div><div id="price" class="value">—</div></div>
  <div class="card"><div class="title">RSI(14) • 30m (computed from Binance klines)</div><div id="rsi" class="value">—</div></div>
  <div class="card"><div class="title">Funding Rate (Binance Perp)</div><div id="funding" class="value">—</div></div>
  <div class="card"><div class="title">Open Interest (Binance Perp)</div><div id="oi" class="value">—</div></div>
  <div class="card"><div class="title">BTC Dominance (CoinGecko)</div><div id="btcd" class="value">—</div></div>
  <div class="card"><div class="title">USDT Dominance (CoinGecko)</div><div id="usdtd" class="value">—</div></div>
  <div class="card"><div class="title">Smart Score</div><div id="score" class="value">—</div></div>
</section>

<footer>
  Built for حسن — v3. Sources: Binance & CoinGecko.
</footer>

<script>
const fmt = (n, d=4) => Number(n).toLocaleString(undefined, {minimumFractionDigits:d, maximumFractionDigits:d});
const fmt0 = (n) => Number(n).toLocaleString(undefined, {maximumFractionDigits:0});

async function fetchJSON(url){
  const r = await fetch(url, {cache:"no-store"});
  if(!r.ok) throw new Error(url + " -> " + r.status);
  return r.json();
}

function rsi14(closes, period=14){
  if (closes.length < period+1) return NaN;
  let gains=0, losses=0;
  for(let i=1;i<=period;i++){
    const ch = closes[i]-closes[i-1];
    if(ch>0) gains += ch; else losses += -ch;
  }
  let avgG = gains/period, avgL = losses/period;
  for(let i=period+1;i<closes.length;i++){
    const ch = closes[i]-closes[i-1];
    const g = ch>0? ch:0, l = ch<0? -ch:0;
    avgG = (avgG*(period-1)+g)/period;
    avgL = (avgL*(period-1)+l)/period;
  }
  const rs = avgL===0 ? 100 : avgG/avgL;
  return 100 - (100/(1+rs));
}

async function load(){
  try{
    const priceJ = await fetchJSON("https://api.binance.com/api/v3/ticker/price?symbol=ORDIUSDT");
    document.getElementById("price").textContent = fmt(priceJ.price,4)+" USDT";

    const kl = await fetchJSON("https://api.binance.com/api/v3/klines?symbol=ORDIUSDT&interval=30m&limit=120");
    const closes = kl.map(k=>Number(k[4]));
    const rsi = rsi14(closes.slice(-100));
    document.getElementById("rsi").textContent = fmt(rsi,2);

    const prem = await fetchJSON("https://fapi.binance.com/fapi/v1/premiumIndex?symbol=ORDIUSDT");
    const fr = Number(prem.lastFundingRate)*100;
    document.getElementById("funding").textContent = fmt(fr,4)+"%";

    const oiJ = await fetchJSON("https://fapi.binance.com/fapi/v1/openInterest?symbol=ORDIUSDT");
    document.getElementById("oi").textContent = fmt0(oiJ.openInterest);

    const g = await fetchJSON("https://api.coingecko.com/api/v3/global");
    const btcd = g.data.market_cap_percentage.btc;
    const usdtd = g.data.market_cap_percentage.usdt;
    document.getElementById("btcd").textContent = fmt(btcd,2)+"%";
    document.getElementById("usdtd").textContent = fmt(usdtd,2)+"%";

    let score = 0;
    if (rsi < 40) score += 1; else if (rsi > 60) score -= 1;
    if (fr < 0) score += 1; else if (fr > 0.05) score -= 1;
    if (btcd < 58.5) score += 0.5; else score -= 0.5;
    if (usdtd < 5.2) score += 0.5; else score -= 0.5;
    const label = score>=1?"Bullish":(score<=-1?"Bearish":"Neutral");
    document.getElementById("score").textContent = label+" ("+fmt(score,2)+")";
    document.getElementById("updated").textContent = "Updated: "+new Date().toLocaleString();
  }catch(e){
    document.getElementById("updated").textContent = "Error: "+e.message;
  }
}

document.getElementById("refresh").addEventListener("click", load);
load();
</script>
</body>
</html>
